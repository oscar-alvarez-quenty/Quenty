# ============================================================================
# API GATEWAY ENVIRONMENT VARIABLES
# ============================================================================
# Central API gateway and routing configuration
# ============================================================================

# ----------------------------------------------------------------------------
# GATEWAY CONFIGURATION
# ----------------------------------------------------------------------------

SERVICE_NAME=api-gateway
SERVICE_PORT=8000
SERVICE_HOST=0.0.0.0
ENVIRONMENT=development
NODE_ENV=development

# ----------------------------------------------------------------------------
# ROUTING CONFIGURATION
# ----------------------------------------------------------------------------

# Service endpoints
AUTH_SERVICE_URL=http://auth-service:8001
CUSTOMER_SERVICE_URL=http://customer-service:8002
ORDER_SERVICE_URL=http://order-service:8003
SHIPPING_SERVICE_URL=http://shipping-service:8004
PAYMENT_SERVICE_URL=http://payment-service:8005
INVENTORY_SERVICE_URL=http://inventory-service:8006
NOTIFICATION_SERVICE_URL=http://notification-service:8007
ANALYTICS_SERVICE_URL=http://analytics-service:8008
CARRIER_SERVICE_URL=http://carrier-integration:8009

# Load balancing
LOAD_BALANCER_ALGORITHM=round_robin  # round_robin, least_connections, weighted
SERVICE_DISCOVERY_ENABLED=false
CONSUL_URL=http://consul:8500

# ----------------------------------------------------------------------------
# AUTHENTICATION & AUTHORIZATION
# ----------------------------------------------------------------------------

# JWT validation
JWT_SECRET_KEY=your-jwt-secret-key-must-match-auth-service
JWT_ALGORITHM=HS256
JWT_VERIFY_EXPIRATION=true
JWT_VERIFY_AUDIENCE=true
JWT_AUDIENCE=quenty-platform

# API Key authentication
API_KEY_ENABLED=true
API_KEY_HEADER=X-API-Key
API_KEY_QUERY_PARAM=api_key

# OAuth2
OAUTH2_ENABLED=true
OAUTH2_INTROSPECTION_URL=http://auth-service:8001/oauth/introspect

# ----------------------------------------------------------------------------
# RATE LIMITING
# ----------------------------------------------------------------------------

# Global rate limits
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW=60000  # 1 minute in ms
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false
RATE_LIMIT_SKIP_FAILED_REQUESTS=false

# Per-service rate limits
AUTH_SERVICE_RATE_LIMIT=50/minute
ORDER_SERVICE_RATE_LIMIT=100/minute
PAYMENT_SERVICE_RATE_LIMIT=30/minute

# Rate limit storage
RATE_LIMIT_STORE=redis  # memory, redis
REDIS_URL=redis://:password@redis:6379/0

# ----------------------------------------------------------------------------
# CIRCUIT BREAKER
# ----------------------------------------------------------------------------

CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_TIMEOUT=30000  # 30 seconds
CIRCUIT_BREAKER_THRESHOLD=50  # percentage
CIRCUIT_BREAKER_DURATION=60000  # 1 minute
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=5

# ----------------------------------------------------------------------------
# REQUEST/RESPONSE HANDLING
# ----------------------------------------------------------------------------

# Timeouts (milliseconds)
DEFAULT_TIMEOUT=30000
AUTH_SERVICE_TIMEOUT=10000
ORDER_SERVICE_TIMEOUT=30000
PAYMENT_SERVICE_TIMEOUT=60000

# Request limits
MAX_REQUEST_SIZE=10mb
MAX_URL_LENGTH=2048
MAX_HEADER_SIZE=8192

# Response compression
COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6
COMPRESSION_THRESHOLD=1024  # bytes

# ----------------------------------------------------------------------------
# CORS CONFIGURATION
# ----------------------------------------------------------------------------

CORS_ENABLED=true
CORS_ORIGINS=http://localhost:3000,https://app.quenty.com
CORS_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-API-Key
CORS_EXPOSED_HEADERS=X-Total-Count,X-Page-Count
CORS_CREDENTIALS=true
CORS_MAX_AGE=86400

# ----------------------------------------------------------------------------
# CACHING
# ----------------------------------------------------------------------------

# Cache configuration
CACHE_ENABLED=true
CACHE_STORE=redis  # memory, redis
CACHE_DEFAULT_TTL=300  # 5 minutes
CACHE_MAX_SIZE=100mb

# Cache rules
CACHE_GET_REQUESTS=true
CACHE_POST_REQUESTS=false
CACHE_AUTH_RESPONSES=false
CACHE_STATIC_CONTENT=true

# Cache headers
CACHE_CONTROL_HEADER=true
ETAG_ENABLED=true

# ----------------------------------------------------------------------------
# SECURITY
# ----------------------------------------------------------------------------

# Security headers
HELMET_ENABLED=true
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
CSP_ENABLED=true
CSP_DIRECTIVES="default-src 'self'"

# Request validation
VALIDATE_REQUEST_BODY=true
VALIDATE_QUERY_PARAMS=true
SANITIZE_INPUT=true
SQL_INJECTION_PROTECTION=true
XSS_PROTECTION=true

# IP filtering
IP_WHITELIST_ENABLED=false
IP_WHITELIST=127.0.0.1,::1
IP_BLACKLIST_ENABLED=false
IP_BLACKLIST=

# DDoS protection
DDOS_PROTECTION_ENABLED=true
DDOS_BURST=100
DDOS_RATE=50

# ----------------------------------------------------------------------------
# LOGGING
# ----------------------------------------------------------------------------

# Log configuration
LOG_LEVEL=info  # debug, info, warn, error
LOG_FORMAT=json  # json, combined, common, dev
LOG_TIMESTAMP=true
LOG_REQUEST_BODY=false
LOG_RESPONSE_BODY=false
LOG_SENSITIVE_HEADERS=false

# Log storage
LOG_TO_FILE=true
LOG_FILE_PATH=/logs/api-gateway.log
LOG_FILE_MAX_SIZE=100mb
LOG_FILE_MAX_FILES=10

# Access logs
ACCESS_LOG_ENABLED=true
ACCESS_LOG_FILE=/logs/access.log
ACCESS_LOG_FORMAT=combined

# ----------------------------------------------------------------------------
# MONITORING & METRICS
# ----------------------------------------------------------------------------

# Metrics collection
METRICS_ENABLED=true
METRICS_PATH=/metrics
METRICS_PORT=9090

# APM (Application Performance Monitoring)
APM_ENABLED=false
APM_SERVICE_NAME=api-gateway
APM_SERVER_URL=http://apm-server:8200
APM_SECRET_TOKEN=

# Tracing
TRACING_ENABLED=true
JAEGER_AGENT_HOST=jaeger
JAEGER_AGENT_PORT=6831
TRACE_SAMPLE_RATE=0.1

# Health checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_INTERVAL=30000  # 30 seconds

# ----------------------------------------------------------------------------
# WEBHOOKS & EVENTS
# ----------------------------------------------------------------------------

# Webhook forwarding
WEBHOOK_ENABLED=true
WEBHOOK_TIMEOUT=10000
WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAY=1000

# Event streaming
EVENT_STREAM_ENABLED=false
KAFKA_BROKERS=kafka:9092
EVENT_TOPIC_PREFIX=gateway

# ----------------------------------------------------------------------------
# API DOCUMENTATION
# ----------------------------------------------------------------------------

# Swagger/OpenAPI
SWAGGER_ENABLED=true
SWAGGER_PATH=/docs
SWAGGER_UI_PATH=/swagger
OPENAPI_PATH=/openapi.json

# API versioning
API_VERSION=v1
API_VERSION_HEADER=X-API-Version
SUPPORT_LEGACY_VERSIONS=true

# ----------------------------------------------------------------------------
# PROXY SETTINGS
# ----------------------------------------------------------------------------

# Upstream proxy
PROXY_ENABLED=false
HTTP_PROXY=
HTTPS_PROXY=
NO_PROXY=localhost,127.0.0.1

# Request forwarding
PRESERVE_HOST_HEADER=true
X_FORWARDED_HEADERS=true
TRUST_PROXY=true
PROXY_TIMEOUT=120000

# ----------------------------------------------------------------------------
# PERFORMANCE
# ----------------------------------------------------------------------------

# Connection pooling
CONNECTION_POOL_SIZE=100
KEEP_ALIVE_TIMEOUT=5000
HEADERS_TIMEOUT=60000

# Worker configuration
CLUSTER_ENABLED=true
WORKER_COUNT=auto  # auto, or specific number

# Memory management
MAX_MEMORY_HEAP=512  # MB
MEMORY_LIMIT_WARNING=400  # MB

# ----------------------------------------------------------------------------
# FEATURE FLAGS
# ----------------------------------------------------------------------------

FEATURE_AUTH_REQUIRED=true
FEATURE_RATE_LIMITING=true
FEATURE_CACHING=true
FEATURE_COMPRESSION=true
FEATURE_REQUEST_ID=true
FEATURE_GRAPHQL=false
FEATURE_WEBSOCKETS=false

# ----------------------------------------------------------------------------
# MAINTENANCE MODE
# ----------------------------------------------------------------------------

MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=System under maintenance. Please try again later.
MAINTENANCE_ALLOWED_IPS=127.0.0.1
MAINTENANCE_BYPASS_KEY=